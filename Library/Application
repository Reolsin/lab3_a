#include "../Lib/Hex.h"

int getint(std::istream& s)
{
	int n;
	const char* err = "";
	do {
		std::cout << err;
		err = "Error. Enter number.\n";
		s.clear();
		s.ignore(s.rdbuf()->in_avail());
		s >> n;
	} while (!s.good());
	s.get();
	return n;
}

int dialog(const char* msgs[], int N)
{
	int rc;
	do {
		system("cls");
		for (int i = 0; i < N; i++)
			std::cout << msgs[i] << std::endl;
		rc = getint(std::cin);
	} while (!std::cin.good());
	return rc;
}

void extand(lab3::Hex*& Hex, int& n) {
	lab3::Hex* tmp = Hex;
	Hex = new lab3::Hex[++n];
	for (int i = 0; i < n; i++)
		Hex[i] = tmp[i];
	delete[] tmp;
}

void delete_f(lab3::Hex*& Hex, int& n, int i1) {
	lab3::Hex* tmp = Hex;
	Hex = new lab3::Hex[--n];
	for (int i = 0, k = 0; i < n; i++) {
		if (i == i1) k = 1;
		Hex[i] = tmp[i + k];
	}
	delete[] tmp;
}

int main()
{
	lab3::Hex* Hex = nullptr;
	int n = 0;
	int i1, i2;
	int rc;
	const char* msgs[] = { "0.Quit", "1.Enter new hex number", "2.Delete hex number", "3.Add", "4.Substract", "5.Show numbers" };
	while (rc = dialog(msgs, 6)) {
		switch (rc)
		{
		case 1: {
			if (n > 0)
				extand(Hex, n);
			else
				Hex = new lab3::Hex[++n];
			Hex[n - 1].input();
			break;
		}
		case 2: {
			if (n < 1) {
				std::cout << "0 Numbers in array." << std::endl;
				break;
			}
			const char* msg = "";
			do {
				std::cout << msg << std::endl;
				i1 = getint(std::cin);
				msg = "Error out of range";
			} while ((i1 < 0) || (i1 > n));

			delete_f(Hex, n, i1 - 1);
			break;
		}
		case 3: {
			if (n < 1) {
				std::cout << "0 Numbers in array." << std::endl;
				break;
			}
			const char* msg = "";
			std::cout << "choose the first number:" << std::endl;
			do {
				std::cout << msg << std::endl;
				i1 = getint(std::cin);
				msg = "Error out of range";
			} while ((i1 < 0) || (i1 > n));
			std::cout << "choose the second number:" << std::endl;
			msg = "";
			do {
				std::cout << msg << std::endl;
				i2 = getint(std::cin);
				msg = "Error out of range";
			} while ((i2 < 0) || (i2 > n));

			Hex[i1 - 1] = Hex[i1 - 1].add(Hex[i2 - 1]);
			break;
		}
		case 4: {
			if (n < 1) {
				std::cout << "0 Numbers in array." << std::endl;
				break;
			}
			const char* msg = "";
			std::cout << "choose the first number:" << std::endl;
			do {
				std::cout << msg << std::endl;
				i1 = getint(std::cin);
				msg = "Error out of range";
			} while ((i1 < 0) || (i1 > n));
			std::cout << "choose the second number:" << std::endl;
			msg = "";
			do {
				std::cout << msg << std::endl;
				i2 = getint(std::cin);
				msg = "Error out of range";
			} while ((i2 < 0) || (i2 > n));

			Hex[i1 - 1].subtract(Hex[i2 - 1]);
			break;
		}
		case 5: {
			for (int i = 0; i < n; i++) {
				std::cout << i + 1;
				Hex[i].print(std::cout);
			}
			break;
		}
		}
		std::cout << "Type any symbol to continue..."; std::cin.get();
	}
	return 0;
}
